<!DOCTYPE html>
<html lang="en">
<head>
	<title>Diagnostics - Bundle Viewer</title>
	<link rel="stylesheet" href="/static/style.css">
	<script src="/static/theme.js"></script>
	<script src="/static/htmx.min.js"></script>
    <style>
        .status-pass { color: var(--success-color, #28a745); font-weight: bold; }
        .status-warning { color: var(--warning-color, #ffc107); font-weight: bold; }
        .status-critical { color: var(--danger-color, #dc3545); font-weight: bold; }
        .status-info { color: var(--info-color, #17a2b8); font-weight: bold; }
        
        .diag-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .diag-table th, .diag-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }
        .diag-table th {
            background-color: var(--header-bg-color);
        }
    </style>
</head>
<body>
	
	</div>
    {{template "nav" (dict "Active" "Diagnostics" "Sessions" .Sessions "ActivePath" .ActivePath "LogsOnly" .LogsOnly)}}

	<h2>Node: {{.NodeHostname}} - Diagnostics Report</h2>

    <p>This report runs automated checks against best-practice configurations and system health indicators.</p>

    {{if .Syslog.OOMEvents}}
    <div style="margin-bottom: 20px; border: 1px solid #dc3545; border-radius: 8px; padding: 20px; background-color: rgba(220, 53, 69, 0.05);">
        <h3 style="color: #dc3545; margin-top: 0;">⚠️ Critical: OOM Killer Events Detected</h3>
        <p>The system Out-Of-Memory (OOM) killer has terminated processes. This indicates severe memory pressure.</p>
        <table class="diag-table">
            <thead>
                <tr>
                    <th>Kernel Time</th>
                    <th>Invoked By</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                {{range .Syslog.OOMEvents}}
                <tr>
                    <td style="font-family: monospace;">{{.Timestamp}}</td>
                    <td>{{.ProcessName}}</td>
                    <td>{{.Message}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{end}}

    <table class="diag-table">
        <thead>
            <tr>
                <th>Status</th>
                <th>Category</th>
                <th>Check</th>
                <th>Current Value</th>
                <th>Expected</th>
                <th>Recommendation</th>
            </tr>
        </thead>
        <tbody>
            {{range .Report.Results}}
            <tr>
                <td class="status-{{.Status | lower}}">{{.Status}}</td>
                <td>{{.Category}}</td>
                <td title="{{.Description}}">{{.Name}}</td>
                <td>{{.CurrentValue}}</td>
                <td>{{.ExpectedValue}}</td>
                <td>{{.Remediation}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>

</body>
</html>
